{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" type="text/css" href="/static/css/navigation.css">
  <link rel="stylesheet" type="text/css" href="/static/css/footer.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"> 
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <title>HOME</title>
  <style>
    a {text-decoration: none;}

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #f8fafc;
    }

    #wrap {
      flex: 1;
    }

    #searchAll{
      position: absolute;
      right: 700px;
    }

    #searchAll .searchIco{
      width: 48px;
      height: 60px;
      display: flex;
      align-items: center;
      margin-right: 10px
    }

    .searchKey {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .searchKey input {
      padding: 12px 18px;
      font-size: 1.2rem;
      border: 2px solid #ffb300;
      border-radius: 6px;
      height: 60px;
      width: 400px;
    }

    .searchKey input:focus {
      outline: none;
      border: 2px solid #4fc3f7;
    }

    .searchKey button {
      padding: 12px 24px;
      font-size: 1.1rem;
      height: 60px;
      border-radius: 6px;
      background: linear-gradient(90deg, #ffb300 0%, #4fc3f7 100%); 
      color: white;
      border: none;
      cursor: pointer;
    }

    .contents::selection{
      background-color: red;
    }

    .contents {
      width: 100%;
      min-height: 1000px;
      height:1600px;
    }

    /* --- ê¸°ë³¸ ì‡¼ì¸  ê´€ë ¨ CSS (ì´ì „ê³¼ ë™ì¼) --- */
    #shortsContainer {
        width: 32%; /* ì¼ë°˜ ëª¨ë“œ ë„ˆë¹„ */
        height: 800px;
        margin: 20px auto;
        display: flex;
        justify-content: space-evenly;
        transition: all 0.3s ease-in-out; /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
    }

    .shorts_title {
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        font-size: 17px;
        padding: 6px 12px;
        font-weight: bold;
        color: #fff;
        max-width: fit-content;
    }

    .creator {
        top: 630px; /* ì´ top ì†ì„±ì€ #shorts ë‚´ì—ì„œ position: absoluteì¼ ë•Œ ì‘ë™ */
        z-index: 2;
        color: #222;
        font-weight: bold;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        font-size: 1.00rem;
        background:#fff;
        margin-bottom:10px;
        border: 1px solid #ddd;
        padding: 6px 12px;
        max-width: fit-content;
    }

    #shortsBorder {
        width: 75%; /* #shortsContainerì˜ 75% ë„ˆë¹„ */
        height: 100%; /* #shortsContainerì™€ ê°™ì€ ë†’ì´ */
        margin: 0 0 0 40px;
        background: #39555e;
        border: 1px solid #ddd;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #shorts {
        width: 90%; /* #shortsBorderì˜ 90% ë„ˆë¹„ */
        height: 85%; /* #shortsBorderì˜ 85% ë†’ì´ */
        margin-top: 25px;
        background: url('') center/cover no-repeat;
        display: flex;
        flex-direction: column;
        padding: 20px;
        justify-content: flex-end; /* ì œëª©ê³¼ ì‘ì„±ìë¥¼ í•˜ë‹¨ìœ¼ë¡œ ë°°ì¹˜ */
        position: relative; /* ìì‹ ìš”ì†Œì˜ absolute í¬ì§€ì…”ë‹ ê¸°ì¤€ */
    }

    #shortsMeta {
        width: 90%;
        padding-top: 18px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        font-size: 1.08rem;
        color: #222;
    }

    #shortsMeta a {
        font-weight: bold;
        color: #fff;
        text-decoration: none;
    }

    #shortsMeta span {
        padding-bottom:10px;
    }

    #shortsMeta span a {
        color: #000000;
        font-size:12px;
        text-decoration: none;
        margin-left: 10px;
        margin-top: 10px;
        display: inline-block;
        border-radius: 10px;
        padding: 5px 5px 5px 10px;
        background: #ffffff;
        box-shadow: 0 2px 2px rgba(0, 0, 0, 1);
    }

    #shortsIcoContainer {
        display: flex;
        flex-direction: column;
        align-items: center; /* ì•„ì´ì½˜ ì¤‘ì•™ ì •ë ¬ */
        justify-content: flex-end; /* í•˜ë‹¨ ì •ë ¬ */
        padding: 20px 0;
        gap: 20px; /* ì•„ì´ì½˜ ê°„ ê°„ê²© */
        height: 95%; /* #shortsContainer ë†’ì´ì— ë§ì¶° */
    }

    .iconBtn {
        font-size: 23px;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0; /* ê¸°ë³¸ íŒ¨ë”© ì œê±° */
    }

    .createBtn {
        margin-bottom: auto; /* ë§¨ ìœ„ë¡œ ë³´ë‚´ê¸° */
        background: linear-gradient(90deg, #ffb300 0%, #4fc3f7 100%); 
        color: white;
        border-radius: 10%;
        width:100%;
    } 

    .list {
      width: 100%;
      min-height: 1000px;

      padding: 30px 0;
    }

    .listTitle {
      width: 60%;
      height: 100px;
      margin: 0 auto;
      text-align: center;
      border-top: rgba(0,0,0,0.1) 1px solid;
      align-items: center;
      display: flex;
      justify-content: center;
    }

    .listTitle h3 {
      margin: auto;
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
    }
    .recommendFestList {
      width: 60%;
      margin: 10px auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      padding: 20px 0 60px 0;
    }

    .festCard {
      width: 200px;
      height: 250px;
      border-radius: 10px;
      overflow: hidden;
      text-align: center;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      background-color: white;
    }

    .festCard img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .festCard p {
      margin-top: 10px;
      font-weight: bold;
      font-size: 1rem;
    }

     /* .dark ëª¨ë“œê°€ ê±¸ë¦¬ë©´ ì „ì²´ ë°°ê²½Â·ê¸€ììƒ‰ ë³€ê²½ */
    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }

    body.dark .contents {
      background-color: #121212; /* ë˜ëŠ” #1a1a1a ë“± ì–´ë‘ìš´ íšŒìƒ‰ */
    }

    /* ë„¤ë¹„ê²Œì´ì…˜, í‘¸í„° ë“±ë„ í•¨ê»˜ ìŠ¤íƒ€ì¼ë§ */
    body.dark #nav,
    body.dark #footer,
    body.dark #pageMove,
    body.dark #shortsBorder {
      background-color: #1f1f1f;
      color: #e0e0e0;
      border-color: #333;
    }

    /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ë¥¼ ë” ëˆˆì— ë„ê²Œ */
    body.dark .searchKey button:hover,
    body.dark .iconBtn:hover,
    body.dark .ldBtn:hover {
      filter: brightness(1.2);
    }

    /* ê²€ìƒ‰ì°½, ì¹´ë“œ ë“± ë°•ìŠ¤ ë°°ê²½ */
    body.dark .searchKey input,
    body.dark .festCard {
      background-color: #1e1e1e;
      border: #333;
      color: #f0f0f0;
    }

    /* ì¹´ë“œ ë‚´ë¶€ í…ìŠ¤íŠ¸ */
    body.dark .festCard p {
      color: #ffffff;
    }

    /* tags */
    body.dark #shortsMeta span a {
      background-color: #2a2a2a;
      color: #ffffff;
      border: 1px solid #444;
    }

    /* ë§í¬ hover */
    body.dark a:hover {
      color: #6ef8f1;
      text-decoration: underline;
    }

    /* ë‹¤í¬ëª¨ë“œì—ì„œ ì„ íƒ ì˜ì—­ ìƒ‰ìƒ ë³€ê²½ */
    body.dark ::selection {
      background-color: #4fc3f7;
      color: #000;
    }

    #shortsContainer:fullscreen,
    #shortsContainer:-webkit-full-screen,
    #shortsContainer:-moz-full-screen,
    #shortsContainer:-ms-fullscreen {
        width: 100vw !important; /* ë·°í¬íŠ¸ ë„ˆë¹„ ì „ì²´ */
        height: 100vh !important; /* ë·°í¬íŠ¸ ë†’ì´ ì „ì²´ */
        margin: 0 !important; /* ë§ˆì§„ ì œê±° */
        position: fixed !important; /* í™”ë©´ì— ê³ ì • */
        background-color: #fff !important;
        z-index: 2147483647 !important; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
        
        /* ë‚´ë¶€ì˜ #shortsBorderì™€ #shortsIcoContainerë¥¼ ì„¸ë¡œí˜•ìœ¼ë¡œ ì¤‘ì•™ì— ë°°ì¹˜ */
        display: flex !important;
        flex-direction: row !important; /* ì‡¼ì¸  ì½˜í…ì¸ ì™€ ì•„ì´ì½˜ì„ ê°€ë¡œë¡œ ë‚˜ë€íˆ ë°°ì¹˜ */
        justify-content: space-evenly !important; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
        align-items: center !important; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ #shortsBorder ìŠ¤íƒ€ì¼ ì¡°ì • (ì‡¼ì¸  ì½˜í…ì¸ ì˜ ë©”ì¸ ì˜ì—­) */
    #shortsContainer:fullscreen #shortsBorder,
    #shortsContainer:-webkit-full-screen #shortsBorder,
    #shortsContainer:-moz-full-screen #shortsBorder,
    #shortsContainer:-ms-fullscreen #shortsBorder {
        /* ê¸°ì¡´ 450pxì—ì„œ ë” ì¤„ì„ */
        width: 380px !important; /* ì‡¼ì¸ ì²˜ëŸ¼ ì¢ì€ ê°€ë¡œ ê¸¸ì´ë¡œ ì¡°ì • (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥) */
        max-width: 80vw !important; /* ë„ˆë¬´ í° í™”ë©´ì—ì„œëŠ” ìµœëŒ€ ë·°í¬íŠ¸ ë„ˆë¹„ì˜ 80%ë¡œ ì œí•œ */
        
        height: 100vh !important; /* ë·°í¬íŠ¸ ë†’ì´ ì „ì²´ë¡œ ìµœëŒ€í•œ ê¸¸ê²Œ ëŠ˜ë¦¼ */
        
        margin: 0 !important; /* ë§ˆì§„ ì œê±° */
        background: #fff !important; /* ë°°ê²½ìƒ‰ (ë‚´ìš©ì´ ì˜ ë³´ì´ë„ë¡ í•˜ì–€ìƒ‰ ìœ ì§€) */
        border: none !important; /* í…Œë‘ë¦¬ ì œê±° */
        border-radius: 0 !important; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì œê±° */
        
        /* ë‚´ë¶€ #shorts (ì´ë¯¸ì§€)ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•˜ê¸° ìœ„í•¨ */
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ #shorts (ì‹¤ì œ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­) ìŠ¤íƒ€ì¼ ì¡°ì • */
    #shortsContainer:fullscreen #shorts,
    #shortsContainer:-webkit-full-screen #shorts,
    #shortsContainer:-moz-full-screen #shorts,
    #shortsContainer:-ms-fullscreen #shorts {
        width: 100% !important; /* #shortsBorder ë„ˆë¹„ì— ê½‰ ì±„ì›€ */
        height: 100% !important; /* #shortsBorder ë†’ì´ì— ê½‰ ì±„ì›€ */
        margin: 0 !important; /* ë§ˆì§„ ì œê±° */
        padding: 0 !important; /* íŒ¨ë”© ì œê±° */
        background-size: cover !important; /* ì´ë¯¸ì§€ê°€ ì˜ë ¤ë„ ê³µê°„ì„ ê½‰ ì±„ìš°ë„ë¡ */
        background-position: center !important;
        background-repeat: no-repeat !important;
        
        /* ì¤Œ/íŒ¨ë‹ ê¸°ëŠ¥ì„ ìœ„í•œ transform ì†ì„±ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ */
        /* position: relative;ì™€ justify-content: flex-end;ëŠ” ê¸°ì¡´ê³¼ ê°™ì´ ìœ ì§€ */
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ #shortsIcoContainer (ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ) ìŠ¤íƒ€ì¼ ì¡°ì • */
    #shortsContainer:fullscreen #shortsIcoContainer,
    #shortsContainer:-webkit-full-screen #shortsIcoContainer,
    #shortsContainer:-moz-full-screen #shortsIcoContainer,
    #shortsContainer:-ms-fullscreen #shortsIcoContainer {
        height: 100vh !important; /* #shortsBorderì™€ ê°™ì€ ë†’ì´ë¡œ ëŠ˜ë¦¼ */
        justify-content: center !important; /* ì „ì²´ í™”ë©´ì—ì„œ ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        padding: 0 40px !important; /* ì¢Œìš° íŒ¨ë”©ìœ¼ë¡œ ì½˜í…ì¸ ì™€ ì•„ì´ì½˜ ë¶„ë¦¬ */
        gap: 30px !important; /* ì•„ì´ì½˜ ê°„ ê°„ê²© ë„“í˜ */
        margin-left: 20px !important;
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ .iconBtn (ê°œë³„ ì•„ì´ì½˜ ë²„íŠ¼) ìŠ¤íƒ€ì¼ ì¡°ì • */
    #shortsContainer:fullscreen .iconBtn,
    #shortsContainer:-webkit-full-screen .iconBtn,
    #shortsContainer:-moz-full-screen .iconBtn,
    #shortsContainer:-ms-fullscreen .iconBtn {
        font-size: 40px !important; /* ì•„ì´ì½˜ í¬ê¸° í™•ëŒ€ */
        width: 100% !important; /* ë²„íŠ¼ ìì²´ í¬ê¸° í™•ëŒ€ */
        height: 100% !important;
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ .createBtn (íŠ¹ë³„í•œ ì•„ì´ì½˜ ë²„íŠ¼) ìŠ¤íƒ€ì¼ ì¡°ì • */
    #shortsContainer:fullscreen .createBtn,
    #shortsContainer:-webkit-full-screen .createBtn,
    #shortsContainer:-moz-full-screen .createBtn,
    #shortsContainer:-ms-fullscreen .createBtn {
        margin-bottom: auto !important; /* ì—¬ì „íˆ ë§¨ ìœ„ë¡œ ë°°ì¹˜ */
        width: 100% !important; /* í¬ê¸° í™•ëŒ€ */
        height: 100% !important;
    }

    /* ì „ì²´ í™”ë©´ì¼ ë•Œ í…ìŠ¤íŠ¸ ìš”ì†Œë“¤ ìœ„ì¹˜ ë° í¬ê¸° ì¡°ì • */
    /* #shorts ë‚´ë¶€ì˜ position: absolute ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì¡°ì • */
    #shortsContainer:fullscreen .creator,
    #shortsContainer:-webkit-full-screen .creator,
    #shortsContainer:-moz-full-screen .creator,
    #shortsContainer:-ms-fullscreen .creator {
        font-size: 2.0rem !important;
        position: absolute !important;
        bottom: 120px !important; /* í•˜ë‹¨ì—ì„œ ì¢€ ë” ìœ„ë¡œ */
        left: 50% !important;
        transform: translateX(-50%) !important;
        white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
    }

    #shortsContainer:fullscreen .shorts_title,
    #shortsContainer:-webkit-full-screen .shorts_title,
    #shortsContainer:-moz-full-screen .shorts_title,
    #shortsContainer:-ms-fullscreen .shorts_title {
        font-size: 2.2em !important; /* ì œëª© ê¸€ê¼´ í™•ëŒ€ */
        position: absolute !important;
        bottom: 60px !important; /* í•˜ë‹¨ì—ì„œ ì¢€ ë” ìœ„ë¡œ */
        left: 50% !important;
        transform: translateX(-50%) !important;
        text-align: center !important;
        max-width: 90% !important; /* í™”ë©´ì„ ë„ˆë¬´ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œí•œ */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    #shortsContainer:fullscreen #shortsMeta,
    #shortsContainer:-webkit-full-screen #shortsMeta,
    #shortsContainer:-moz-full-screen #shortsMeta,
    #shortsContainer:-ms-fullscreen #shortsMeta {
        position: absolute !important;
        bottom: 20px !important; /* ê°€ì¥ í•˜ë‹¨ì— ë°°ì¹˜ */
        left: 50% !important;
        transform: translateX(-50%) !important;
        flex-direction: row !important; /* ê°€ë¡œë¡œ ë°°ì¹˜ (íƒœê·¸ì™€ ì¶•ì œ ì´ë¦„) */
        justify-content: center !important;
        align-items: center !important;
        width: auto !important; /* ë„ˆë¹„ ìë™ ì¡°ì ˆ */
        padding-top: 0 !important;
    }

    #shortsContainer:fullscreen .festNameInShorts,
    #shortsContainer:-webkit-full-screen .festNameInShorts {
        font-size: 1.2em !important; /* ì¶•ì œ ì´ë¦„ ê¸€ê¼´ í™•ëŒ€ */
        margin-right: 15px !important; /* íƒœê·¸ì™€ì˜ ê°„ê²© */
    }

    #shortsContainer:fullscreen .tags,
    #shortsContainer:-webkit-full-screen .tags {
        font-size: 0.9em !important; /* íƒœê·¸ ê¸€ê¼´ í™•ëŒ€ */
        display: flex !important; /* íƒœê·¸ë“¤ì„ í”Œë ‰ìŠ¤ ë°•ìŠ¤ë¡œ ì²˜ë¦¬ */
        flex-wrap: wrap; /* íƒœê·¸ê°€ ë§ì„ ê²½ìš° ì¤„ë°”ê¿ˆ */
        gap: 5px; /* ê° íƒœê·¸ ê°„ ê°„ê²© */
    }

    #shortsContainer:fullscreen #shortsMeta span a,
    #shortsContainer:-webkit-full-screen #shortsMeta span a {
        font-size: 0.9em !important; /* ê°œë³„ íƒœê·¸ ê¸€ê¼´ ì¡°ì • */
        padding: 8px 15px !important; /* íŒ¨ë”© ì¡°ì • */
        margin-left: 0 !important; /* ê¸°ì¡´ ë§ˆì§„ ì œê±° */
    }

  </style>
  <script>
        let scrollTimer,season,shortsContainer,shortsBorder,shortsIcoContainer,iconButtons;
        let currentShortIndex = 0; // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì‡¼ì¸ ì˜ ì¸ë±ìŠ¤ (shortformsData ë°°ì—´ ê¸°ì¤€)
        let currentImageIndex = 0; // í˜„ì¬ ì‡¼ì¸  ë‚´ì—ì„œ ì´ë¯¸ì§€ ìˆœí™˜ì„ ìœ„í•œ ì¸ë±ìŠ¤
        let startX, isDragging = false; // ë“œë˜ê·¸ ê´€ë ¨ ë³€ìˆ˜
        let shortformsData = [],festivalsData = []; // sListì—ì„œ ë°›ì•„ì˜¨ ëª¨ë“  ì‡¼ì¸  ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€// jListì—ì„œ ë°›ì•„ì˜¨ ëª¨ë“  ì¶•ì œ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        let initialShortformId = '{{shortform.id}}';
        let originalShortsBorderWidth = '', originalShortsBorderHeight = '' ,originalShortsContainerBackgroundColor = '';
        // DOMì´ ë¡œë“œë˜ë©´ ë°”ë¡œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 1000, // ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„
                once: true, // ì• ë‹ˆë©”ì´ì…˜ì„ í•œ ë²ˆë§Œ ì‹¤í–‰
            }); 
            
            // ëª¨ë“  AJAX ìš”ì²­ì´ ì™„ë£Œëœ í›„ì— ì‹¤í–‰ë  Promise.all ì‚¬ìš©
            Promise.all([
            // sList AJAX ìš”ì²­ (ì‡¼ì¸  ë°ì´í„°)
              $.ajax({
                url: `/slist/${initialShortformId}/`,
                type: 'GET',
                dataType: 'json'
              }),
              // jList AJAX ìš”ì²­ (ì¶•ì œ ë¦¬ìŠ¤íŠ¸ ë°ì´í„°)
              $.ajax({
                url: '/jlist/',
                type: 'GET',
                dataType: 'json'
              })
            ]).then(function(results) {
              // ëª¨ë“  AJAX ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ ì‹¤í–‰
              const shortformsResponse = results[0]; // sList ì‘ë‹µ
              const festivalsResponse = results[1]; // jList ì‘ë‹µ
              season = festivalsResponse[0].tag

              // shortformsData í• ë‹¹ (data.shortformsë¡œ ì ‘ê·¼)
              shortformsData = shortformsResponse.shortforms || []; 
              
              // festivalsData í• ë‹¹ (jList ì‘ë‹µ ê·¸ëŒ€ë¡œ í• ë‹¹)
              festivalsData = festivalsResponse || []; 
              
              // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
              if (!Array.isArray(festivalsData) || festivalsData.length === 0) {
                console.error("Error: No festival data received from jlist or data is not an array.");
                $('.listTitle').html('<p>ì¶•ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>');
              } else {
                addlist(festivalsData); // ì¶•ì œ ë¦¬ìŠ¤íŠ¸ UI ì—…ë°ì´íŠ¸
              }
              
              if (!Array.isArray(shortformsData) || shortformsData.length === 0) {
                console.error("Error: No shortform data received from slist or data is not an array.");
                $('#shorts').html('<p>ì‡¼ì¸  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>');
              } else {
                // ì´ˆê¸° ì‡¼ì¸  UI ì—…ë°ì´íŠ¸ (ì²« ë²ˆì§¸ ì‡¼ì¸  ë°ì´í„°ë¡œ)
                updateShortsContent(shortformsData[currentShortIndex]); 
                // 5ì´ˆë§ˆë‹¤ ì´ë¯¸ì§€ ìˆœí™˜ ì‹œì‘ (í˜„ì¬ ì‡¼ì¸  ë‚´ ì´ë¯¸ì§€)
                setInterval(changeShortsImage, 5000); 
              }
            })
            .catch(function(error) {
              // Promise.all ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì‹¤í–‰
              console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
              $('#shortsContainer').html('<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>');
              $('.listTitle').html('<p>ì¶•ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>');
            });

            shortsContainer = document.getElementById('shortsContainer');
            shortsBorder = document.getElementById('shortsBorder');
            shortsIcoContainer = document.getElementById('shortsIcoContainer'); // í• ë‹¹
            iconButtons = document.querySelectorAll('.iconBtn'); // í• ë‹¹ (NodeList)
            
            document.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement) {
                    // 1. #shortsContainer ë°°ê²½ìƒ‰ ë³€ê²½
                    originalShortsContainerBackgroundColor = window.getComputedStyle(shortsContainer).backgroundColor;
                    shortsContainer.style.backgroundColor = '#f8fafc';
                    // **ì „ì²´ í™”ë©´ ëª¨ë“œë¡œ ì§„ì… ì‹œ (viewBtn í´ë¦­ì´ ì•„ë‹ˆë”ë¼ë„)**
                    console.log('Entered fullscreen mode. CSS :fullscreen rules should now apply.');
                    shortsBorder.style.width = '30%'; 
                    shortsBorder.style.height = '100vh';
                    // 2. #shortsContainer justify-content ë³€ê²½
                    originalShortsContainerJustifyContent = window.getComputedStyle(shortsContainer).justifyContent;
                    shortsContainer.style.justifyContent = 'center';

                    // 3. #shortsIcoContainer margin-left ì¶”ê°€
                    originalShortsIcoContainerMarginLeft = window.getComputedStyle(shortsIcoContainer).marginLeft;
                    shortsIcoContainer.style.marginLeft = '20px';

                    // 4. .iconBtn font-size ë³€ê²½
                    if (iconButtons.length > 0) {
                        originalIconBtnFontSize = window.getComputedStyle(iconButtons[0]).fontSize; // ì²« ë²ˆì§¸ ë²„íŠ¼ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥
                        iconButtons.forEach(btn => {
                            btn.style.fontSize = '40px';
                        });
                    }
                } else {
                    // **ì „ì²´ í™”ë©´ ëª¨ë“œì—ì„œ ë‚˜ê°ˆ ë•Œ (Esc í‚¤, F11, ë˜ëŠ” exitFullscreen í˜¸ì¶œ ì‹œ)**
                    shortsContainer.style.removeProperty('background-color');
                    console.log('Exited fullscreen mode. Reverting specific inline styles.');
                    shortsBorder.style.removeProperty('width'); // CSSë¡œ ì¶©ë¶„íˆ ì œì–´ëœë‹¤ë©´ ì œê±°
                    shortsBorder.style.removeProperty('height'); // CSSë¡œ ì¶©ë¶„íˆ ì œì–´ëœë‹¤ë©´ ì œê±°
                    shortsContainer.style.removeProperty('justify-content');
                    shortsIcoContainer.style.removeProperty('margin-left');
                    iconButtons.forEach(btn => btn.style.removeProperty('font-size'));
                }
            });
            setupInitialShortsUI('bottom',season); 
            // #shortsContainerì— ëŒ€í•œ íœ  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (jQuery ready í•¨ìˆ˜ ì•ˆìœ¼ë¡œ ì´ë™)
            $('#wrap').on('wheel', '#shortsContainer', function(e) {
                e.preventDefault();
                clearTimeout(scrollTimer);

                if (!shortformsData || shortformsData.length === 0) { 
                    return; // ì‡¼ì¸  ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìŠ¤í¬ë¡¤ ë™ì‘ ì•ˆ í•¨
                }

                if (e.originalEvent.deltaY > 0) { // íœ ì„ ë‚´ë¦¬ë©´ (ë‹¤ìŒ ì‡¼ì¸ )
                    if (currentShortIndex < shortformsData.length - 1) { 
                        scrollTimer = setTimeout(function() {
                            currentShortIndex++;
                            currentImageIndex = 0; // ìƒˆ ì‡¼ì¸ ë¡œ ì´ë™í•˜ë©´ ì´ë¯¸ì§€ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
                            applyAOSAnimation('up'); // ì‡¼ì¸  ì»¨í…Œì´ë„ˆ AOS ì• ë‹ˆë©”ì´ì…˜
                            updateShortsContent(shortformsData[currentShortIndex]); // ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì‡¼ì¸  ì½˜í…ì¸  ì—…ë°ì´íŠ¸
                        }, 500); // 0.5ì´ˆ ë””ë°”ìš´ìŠ¤
                    }
                } else { // íœ ì„ ì˜¬ë¦¬ë©´ (ì´ì „ ì‡¼ì¸ )
                    if (currentShortIndex > 0) { 
                        scrollTimer = setTimeout(function() {
                            currentShortIndex--;
                            currentImageIndex = 0; // ìƒˆ ì‡¼ì¸ ë¡œ ì´ë™í•˜ë©´ ì´ë¯¸ì§€ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
                            applyAOSAnimation('down'); // ì‡¼ì¸  ì»¨í…Œì´ë„ˆ AOS ì• ë‹ˆë©”ì´ì…˜
                            updateShortsContent(shortformsData[currentShortIndex]); // ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì‡¼ì¸  ì½˜í…ì¸  ì—…ë°ì´íŠ¸
                        }, 500); // 0.5ì´ˆ ë””ë°”ìš´ìŠ¤
                    }
                }
              });
        }); // document.ready end
        
        // setupInitialShortsUI í•¨ìˆ˜ (DOMContentLoaded ì•ˆì— ìˆì—ˆìœ¼ë¯€ë¡œ, í•„ìš”ì— ë”°ë¼ ì™¸ë¶€ë¡œ ëº„ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
        function setupInitialShortsUI(animove) {
            const initialShortsHtml = `
                <div id="shortsContainer" data-aos="fade-${animove}"> 
                    <div id="shortsBorder"> 
                        <data id="shorts">
                            <a class="creator">@ì¶•ì œëª¨ì•„</a>
                            <a class="shorts_title">ìš”ì¦˜ ì…ì†Œë¬¸ íƒ„ë‹¤ëŠ” ì¶•ì œ</a>
                        </data>
                        <div id="shortsMeta">
                            <a href="#" class="festNameInShorts"></a>
                            <span class="tags" style="font-size: 15px;"></span>
                        </div>
                    </div>
                    <div id="shortsIcoContainer">
                        <button class="iconBtn createBtn" onclick="createBtn()">+</button>
                        <button class="iconBtn likeBtn" onclick="likeBtn()">â¤ï¸</button>
                        <button class="iconBtn shareBtn" onclick="shareBtn()">ğŸ”„</button>
                        <button class="iconBtn reviewBtn" onclick="reviewBtn()">ğŸ“</button>
                        <button class="iconBtn viewBtn" onclick="viewBtn()">ğŸ‘ï¸</button>
                    </div>
                </div>
                <div class="listTitle"><h3> Festivals</h3></div>
                <div class="recommendFestList"></div>`; // ë‹«ëŠ” <div> íƒœê·¸ëŠ” addlistì—ì„œ ì¶”ê°€ë  ê²ƒì´ë¯€ë¡œ ì—¬ê¸°ì„œ ì œê±°
            $('.contents').html(initialShortsHtml);
            AOS.refresh(); 
        }

        // shortsContainerì˜ AOS ì• ë‹ˆë©”ì´ì…˜ë§Œ ì ìš©í•˜ëŠ” í•¨ìˆ˜
        function applyAOSAnimation(animove) {
            $('#shortsContainer').attr('data-aos', `fade-${animove}`);
            AOS.refresh(); 
        }

        // shortsContainer ë‚´ë¶€ì˜ ì½˜í…ì¸ ë¥¼ ë°ì´í„°ì— ë§ì¶° ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateShortsContent(shortformItem) {
            if (!shortformItem) {
                console.warn("shortformItemì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }
            
            // ì‡¼ì¸  ì œëª© ì—…ë°ì´íŠ¸
            $('#shorts .creator').text('@'+shortformItem.user.nickname);
            $('#shorts .shorts_title').text(shortformItem.title); // 'shorts_title' í´ë˜ìŠ¤ ì‚¬ìš©

            // 1. ì‡¼ì¸  ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            const imageUrl = shortformItem.images && shortformItem.images.length > currentImageIndex ?
                            shortformItem.images[currentImageIndex].image_url : ''; 
            
            // ë°°ê²½ ì´ë¯¸ì§€ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
            $('#shorts').css('background-image', `url('${imageUrl}')`); 
            $('#shorts').css('background-size', 'cover');      // ì´ë¯¸ì§€ê°€ ìš”ì†Œë¥¼ ê½‰ ì±„ìš°ë„ë¡ ì„¤ì •
            $('#shorts').css('background-position', 'center'); // ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì— ìœ„ì¹˜ì‹œí‚´
            $('#shorts').css('background-repeat', 'no-repeat'); 

            // 2. ì¶•ì œ ì´ë¦„ ì—…ë°ì´íŠ¸
            const festival = shortformItem.festival;
            const festivalName = festival && festival.name ? festival.name : 'ì—†ì–´ì§„ ì¶•ì œì…ë‹ˆë‹¤';
            const festivalId = festival && festival.id ? festival.id : null;

            $('.festNameInShorts').text(festivalName);
            if (festivalId) {
                $('.festNameInShorts').attr('href', `/festivals/view/${festivalId}/`);
            } else {
                $('.festNameInShorts').removeAttr('href').css('cursor', 'default'); 
            }

            // 3. ì¶•ì œ íƒœê·¸ ì—…ë°ì´íŠ¸
            const tagsHtml = (festival && festival.tags && Array.isArray(festival.tags) && festival.tags.length > 0) ?
                festival.tags.map(tag => `<a href="result_list.html?tag=${encodeURIComponent(tag.name)}">#${tag.name}</a>`).join(' ') : '';
            $('.tags').html(tagsHtml);

            if (shortformItem.frame_color) {
                $('#shortsBorder').css('background', shortformItem.frame_color);
            } else {
                // frame_colorê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ì„¤ì •í•˜ê±°ë‚˜ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                $('#shortsBorder').css('background', '#39555e'); // CSSì— ì •ì˜ëœ ê¸°ë³¸ê°’ìœ¼ë¡œ ëª…ì‹œì ìœ¼ë¡œ ë˜ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            }
            document.querySelector('.listTitle h3').textContent = `${season} Festivals`;

            const shortformId = shortformItem.id;
            if (shortformId !== undefined) {
                const newUrl = `/${shortformId}/`; // Django URL íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ë„ë¡ ê²½ë¡œ ì„¤ì •
                history.pushState({shortformId: shortformId}, '', newUrl);
            }
        }

        // í˜„ì¬ ì‡¼ì¸  ë‚´ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìˆœí™˜í•˜ëŠ” í•¨ìˆ˜
        function changeShortsImage() {
            if (!shortformsData || shortformsData.length === 0) return; // ë°ì´í„° ì—†ìœ¼ë©´ ì¢…ë£Œ

            const currentShort = shortformsData[currentShortIndex]; // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì‡¼ì¸  ë°ì´í„°
            if (currentShort && currentShort.images && currentShort.images.length > 0) {
                currentImageIndex++;
                if (currentImageIndex >= currentShort.images.length) { 
                    currentImageIndex = 0; // í˜„ì¬ ì‡¼ì¸ ì˜ ëª¨ë“  ì´ë¯¸ì§€ë¥¼ ë´¤ìœ¼ë©´ ë‹¤ì‹œ ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¡œ
                }
                // í˜„ì¬ ì‡¼ì¸  (currentShortIndex)ì˜ currentImageIndexë²ˆì§¸ ì´ë¯¸ì§€ë¡œ ì—…ë°ì´íŠ¸
                updateShortsContent(currentShort); 
            }
        }

        // addlist í•¨ìˆ˜ (ì¶”ì²œ ì¶•ì œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±)
        function addlist(data){ // data ì¸ìë¡œ festivalsDataë¥¼ ë°›ìŠµë‹ˆë‹¤
            let jdata = ``;
            for (let k = 0; k < data.length && k < 8; k++) { // ìµœëŒ€ 8ê°œ ë˜ëŠ” data.length ë§Œí¼
                const festival = data[k];
                // image í•„ë“œëŠ” jlist ì‘ë‹µì˜ festival ê°ì²´ì— ì§ì ‘ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
                // ì˜ˆë¥¼ ë“¤ì–´, festival.image_url ë˜ëŠ” festival.main_image_url
                // í˜„ì¬ ì½”ë“œì—ì„œëŠ” `festival.image`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ, `jlist`ì—ì„œ í•´ë‹¹ í•„ë“œë¥¼ ì œê³µí•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
                const imageUrl = festival.image || 'ê²½ë¡œ/ê¸°ë³¸_ì´ë¯¸ì§€.png'; // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë¯¸ì§€
                jdata += `<a href="/festivals/view/${festival.id}/"><div class="festCard"><img src="${imageUrl}" alt="${festival.name} ì¶•ì œ ì´ë¯¸ì§€"><p>${festival.name}</p></div></a>`;
            }
            $('.recommendFestList').html(jdata); // div ë‹«ëŠ” íƒœê·¸ëŠ” HTML êµ¬ì¡°ì— ë”°ë¼ ì²˜ë¦¬
        }

        // ì•„ì´ì½˜ ë²„íŠ¼ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
        function createBtn() { location.href='/shortforms/upload/'; }
        function likeBtn() { console.log('Like Button clicked'); }
        
        function reviewBtn() { console.log('Review Button clicked'); }
        function viewBtn() {
            if (!shortsContainer) { // DOMContentLoadedì—ì„œ ì´ë¯¸ í• ë‹¹ë˜ì§€ë§Œ, ì•ˆì „ì„ ìœ„í•´ ì¬í™•ì¸
                shortsContainer = document.getElementById('shortsContainer');
                shortsBorder = document.getElementById('shortsBorder');
                shortsIcoContainer = document.getElementById('shortsIcoContainer');
                iconButtons = document.querySelectorAll('.iconBtn');
                if (!shortsContainer || !shortsBorder || !shortsIcoContainer || iconButtons.length === 0) {
                    console.error("Shorts elements not found before fullscreen request.");
                    return;
                }
            }

            if (document.fullscreenElement) {
                document.exitFullscreen(); // ì „ì²´ í™”ë©´ ì¢…ë£Œ ìš”ì²­
            } else {
                // ì „ì²´ í™”ë©´ ì§„ì… ìš”ì²­
                if (shortsContainer.requestFullscreen) {
                    shortsContainer.requestFullscreen();
                } else if (shortsContainer.mozRequestFullScreen) {
                    shortsContainer.mozRequestFullScreen();
                } else if (shortsContainer.webkitRequestFullscreen) {
                    shortsContainer.webkitRequestFullscreen();
                } else if (shortsContainer.msRequestFullscreen) {
                    shortsContainer.msRequestFullscreen();
                }
            }
        }
        function searchBtn(event) {
          event.preventDefault();
          const keyword = $('input[name="keyWord"]').val().trim();
          console.log(keyword);
          const url = `http://127.0.0.1:8000/festivals/list/?name=${encodeURIComponent(keyword)}`;
          window.location.href = url
          window.history.pushState(null, '', newUrl.toString());
        }
        function ldBtn() {
          document.body.classList.toggle('dark');
          // (ì„ íƒ) ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìƒíƒœ ì €ì¥
          const isDark = document.body.classList.contains('dark');
          localStorage.setItem('darkMode', isDark);
        }
        function shareBtn() {
          // 1. í˜„ì¬ í˜ì´ì§€ì˜ URL ê°€ì ¸ì˜¤ê¸°
          const currentUrl = window.location.href;

          navigator.clipboard.writeText(currentUrl)
              .then(() => {
                  alert('í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                  console.log('URLì´ ì„±ê³µì ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:', currentUrl);
              })
              .catch(err => {     
                  console.error('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                  alert('URL ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:\n' + currentUrl);
              });
        }
        function logoBtn() {
          location.href='/';
        }
        function shareBtn() {
          // 1. í˜„ì¬ í˜ì´ì§€ì˜ URL ê°€ì ¸ì˜¤ê¸°
          const currentUrl = window.location.href;

          navigator.clipboard.writeText(currentUrl)
              .then(() => {
                  alert('í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                  console.log('URLì´ ì„±ê³µì ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:', currentUrl);
              })
              .catch(err => {     
                  console.error('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                  alert('URL ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:\n' + currentUrl);
              });
        }
  </script>
</head>
<body>
  <div id="wrap">
    <div id="nav">
      
      <div id="logo">
        <a href="/"><img id="logo_img" src="/static/image/logo_transparent_cut.png" alt="Logo" ></a>
        {% if user_id %}
        <span>forã€€<span><a href="/accounts/mypage1/">{{nickname}}</a></span></span>
        {% endif %}
      </div>

      <div id="searchAll">
        <form action="fest_list.html" method="GET" onsubmit="searchBtn(event)">
          <div class="searchKey">
            <input name="keyWord" type="text" placeholder="name Search" />
            <button type="submit">ê²€ìƒ‰</button>
          </div>
        </form>
      </div>

      <div id="pageMove">     
        <ul>
          <li><a href="/festivals/list/">festivals</a></li>
          {% if user_id %}
              <li><a href="/accounts/logout/">logout</a></li>
              <li><a href="/accounts/mypage1/">my page</a></li>
          {% else %}
              <li><a href="/accounts/login/">login</a></li>
              <li><a href="/accounts/signup/terms/">sign up</a></li>
          {% endif %}
          <li><a href="/inquiry/support/">support</a></li>  
        </ul>
      </div>

    </div>

    <div class="contents">
      
  </div>

  {% include "footer.html" %}

  {% comment %} <div id="footer">
    <h4>Â© 2025 FastFest | ì‚¬ì´íŠ¸ ê°œë°œì ì •ë³´</h4>
    <ul class="footer-links">
      <li><a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></li>
      <li><a href="#">ì´ìš©ì•½ê´€</a></li>
      <li><a href="#">ê´€ë¦¬ìí˜ì´ì§€ ì´ë™</a></li>
      <li>
        <div id="ldMode">
          <button type="button" class="ldBtn" onclick="ldBtn()">ë‹¤í¬ëª¨ë“œ</button>
        </div>
      </li>
    </ul>
  </div>  {% endcomment %}
</body>
